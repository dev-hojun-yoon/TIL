# 25. 7. 31 (Thurs)

* docker container 설계
  * 도커 컨테이너 생성 시 주의사항
    * 컨테이너당 1 프로세스
    * 변경 불가능한 인프라를 구성하는 걸 원칙으로 함
    * 경량 도커 이미지 구성
      * alpine 과 java 도 실행에 필요한 JRE 만 가져다가 tomcat 폴더로 스위칭
      * alpine 를 붙이면 서비스 동작에 필요한 것만 포함된 패키지
      * 결과 확인
        <img width="565" height="75" alt="image" src="https://github.com/user-attachments/assets/cd3f4e43-90cd-4b5b-903d-17946fa4bc90" />

    * 실행 계정은 root 외 사용자로 지정
  * Jenkins, Github Action 을 이용한 CI/CD 파이프라인 구축
  * multi-stage builds 를 활용
    * 설치 빌드를 위한 것과 실행 빌드 등을 구분할 수 있음
    * 기존 tomcat single 대비 1/10 수준의 용량
    * 이미지 용량이 적으면 업데이트 시 네트워크 비용도 줄일 수 있음
    * 빌드용 컨테이너는 생성하고 없어짐 -> 유저 생성하고 권한을 줄 필요가 없다.
  * RUN 하나의 명령어로 담으면 디버깅할 수 있으니 명령줄마다 RUN 을 구분

* 기타
  * Monolithic: 단단히 짜여 하나로 되어 있는
    * 하나의 서비스, 어플리케이션이 하나의 거대한 아키텍처를 가짐.
  * gRPC
    * 현대적인 마이크로서비스 환경에서 주로 사용되는 고성능 원격 프로시저 호출 (gRPC, Remote Procedure Call) 프레임워크
    * 클라이언트가 서버의 메소드를 로컬 함수처럼 호출할 수 있게 하는 프레임워크
    * 기존 REST 방식과 달리, 더 빠르고 / 타입 안정성이 높고 / 양방향 스트리밍을 지원
    * Protocol Buffers (protobuf) 이진 직렬화 포맷을 사용해 데이터 교환
    * 다양한 언어 지원: go, java, python, c++, node.js, kotlin
  * docker desktop 이미지 저장 경로 변경
    * 기존의 docker wsl 저장소 폴더 이동
      * %USERPROFILE%\AppData\Local\Docker\wsl\data
      * USERPROFILE 은 set 명령어로 확인할 수 있는 윈도우 환경변수
      * robocopy "%LOCALAPPDATA%\Docker\wsl\data" "E:\DockerData" /e
        * robocopy 는 NTFS 권한과 하위 폴더까지 복사함. /e 는 빈 폴더 포함
    * 기존 폴더 삭제 or 이름 변경
      * ren "%LOCALAPPDATA%\Docker\wsl\data" "data_backup"
    * 심볼릭 링크 (symbolic link) : 바로가기처럼 작동하는 가상 폴더
      * 윈도우에서는 mklink
      * mklink /d "가상 경로" "실제 경로"
      * mklink /d "%LOCALAPPDATA%\Docker\wsl\data" "E:\DockerData"
      * 가상 경로는 외부에서 접근할 가짜 주소로 즉, docker 가 보게될 경로이다.
      * 실제 경로는 데이터를 실제로 저장할 실제 물리적 주소 (외장 SSD)
