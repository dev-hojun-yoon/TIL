# 25. 8. 8 (Fri)

* ElasticSearch
  * 인덱스를 위한 색인하기 위한 커스텀 애널라이저는 해당 인덱스 안의 settings 에 작성하고, mappings 에서 가져다 쓴다.
  * 변경을 위해서는 기존에 설정된 인덱스를 제거해야 한다.
  * 샘플
    ```
    https://www.elastic.co/docs/reference/elasticsearch/plugins/analysis-nori-speech

    PUT nori_sample
    {
      "settings": {
        "index": {
          "analysis": {
            "analyzer": {
              "my_analyzer": {
                "tokenizer": "nori_tokenizer",
                "filter": [
                  "my_posfilter"
                ]
              }
            },
            "filter": {
              "my_posfilter": {
                "type": "nori_part_of_speech",
                "stoptags": [
                  "NR"
                ]
              }
            }
          }
        }
      }
    }
    
    GET nori_sample/_analyze
    {
      "analyzer": "my_analyzer",
      "text": "여섯 용이"
    }
    ```
    ```
    PUT nori_sample
    {
      "settings": {
        "index": {
          "analysis": {
            "analyzer": {
              "my_analyzer": {
                "tokenizer": "nori_tokenizer",
                "filter": [ "nori_readingform" ]
              }
            }
          }
        }
      }
    }
    
    GET nori_sample/_analyze
    {
      "analyzer": "my_analyzer",
      "text": "鄕歌"
    }
    ```
    십만이천오백과 -> 숫자로 변경
    ３.２천 -> 3200 으로 콤마에 대한 후처리
    ```
    PUT nori_sample
    {
      "settings": {
        "index": {
          "analysis": {
            "analyzer": {
              "my_analyzer": {
                "tokenizer": "tokenizer_discard_puncuation_false",
                "filter": [
                  "part_of_speech_stop_sp", "nori_number"
                ]
              }
            },
            "tokenizer": {
              "tokenizer_discard_puncuation_false": {
                "type": "nori_tokenizer",
                "discard_punctuation": "false"
              }
            },
            "filter": {
                "part_of_speech_stop_sp": {
                    "type": "nori_part_of_speech",
                    "stoptags": ["SP"]
                }
            }
          }
        }
      }
    }
    
    GET nori_sample/_analyze
    {
      "analyzer": "my_analyzer",
      "text": "십만이천오백과 ３.２천"
    }
    ```
  * 리마인드
    * 윤동주 시인의 '별 헤는 밤' 시로 실습
    * 한글은 복합어, 합성어가 많아 하나의 단어도 여러 어간으로 분리 필요 -> 한글 형태소 사전 필요 (nori)
    * 시 내용에는 憧憬 과 같은 한자가 있음, 이를 -> 동경으로 변환해주려면 Synonym Filter 로 직접 등록 필요
    * custom 을 위해 토크나이저, 토큰 필터를 설정
      * nor_tokenizer (decompound_mode, user_dictionary)
      * 토큰 필터 (nori_part_of_speech, nori_readingform, nori_number)
      * decompound_mode 는 none 으로 세부적으로 분리되지 않도록 설정하고,
      * 의미 없는 공백은 없애도록 했습니다. "discard_punctuation": "true"
      * "type": "nori_part_of_speech"
        * 형태소 분석 후 특정 품사 (POS, part of speech) 에 해당하는 토큰을 제거하기 위해 사용
        * 조사, 기호, 감탄사 등 불필요한 품사를 제거해서 검색 정확도를 높인다.
      * "stoptags": ["SP"]
        * 기호 (special symbol) 를 의미하는 품사 코드
        * 기호에 해당하는 형태소를 제거하는 의미이다.
        * 따라서 쉼표, 마침표, 따옴표, 괄호 등 기호 토큰을 제거
      * 주요 POS 코드 요약
        * NNG 일반 명사 (학생 / 책)
        * NNP 고유 명사 (서울 / 윤동주)
        * VV 동사 (가다 / 보다)
        * VA 형용사 (멋진 / 큰)
        * JKS 주격 조사 (이 / 가)
        * JKB 부사격 조사 (에 / 에서)
        * SP 기호 (, . : ())
        * IC 감탄사 (와!, 아!)
        * SF 마침표 등 문장 기호 (. / ? / !)
