# 25. 8. 7 (Thurs)

* ElasticSearch
  * 인덱스를 생성할 때 PUT 메소드를 사용한다.
  * POST /{인덱스명}/_doc 메소드 호출로 문서를 생성
  * 전체 중에 일부 데이터만 수정해야하는 경우
    ```
    POST /my-index3/_update/12
    {
      "doc": {
        "document_number": 4
      }
    }
    ```
  * 전체 데이터를 수정하는 경우 (나머지 필드가 모두 날라가고 document_number 필드만 남아 있음
    ```
    PUT /my_index3/_doc/{id}
    {
      "document_number": 4
    }
    ```
  * unix time 을 지정하였지만, 별도로 형 지정을 하지 않으면 long type 으로 저장
  * name 은 string 으로 지정하였는데 아래와 같이 text, keyword 가 모두 커버가 가능하도록 지정됨.
    ```
    "name": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        }
    ```
  * 복합 자료형도 심플자료형과 같은 방식으로 검색한다.
  * object 타입은 세부 요소가 모두 같은 타입으로 통일돼야 한다.
  * object 와 nested 타입의 차이점
    * nested 데이터 검색 예시 (인덱스 내의 별도의 doc 으로 관리횐다.) // 내부적으로 doc 안에 평탄화되는 object 와 비교
      부득이하게 students 필드를 doc 안의 doc 으로 관리해야 하는 경우
      ```
      PUT woorifisa_nested_test
      {
        "mappings": {
        "properties": {
          "students": {
            "type": "nested",
            "properties": {
              "name": {
                "type": "keyword"
              },
              "age": {
                "type": "long"
              }
            }
          }
        }
      }
      }

      # 검색 방법
      GET woorifisa_nested_test/_search
      {
        "query": {
          "nested": {
            "path": "student",
            "query": {
              "match": {
                "student.name": "신짱구"
              }
            }
          }
        }
      }
      ```
